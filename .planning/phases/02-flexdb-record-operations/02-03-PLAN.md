---
phase: 02-flexdb-record-operations
plan: 03
type: execute
wave: 1
depends_on: []
files_modified:
  - apps/api/drizzle/0008_fulltext_search_index.sql
  - apps/api/readme.md
autonomous: true
gap_closure: true

must_haves:
  truths:
    - "FULLTEXT index exists on flex_records.search_text column"
    - "Full-text search queries use the FULLTEXT index for performance"
    - "Migration instructions are documented for deployment"
  artifacts:
    - path: "apps/api/drizzle/0008_fulltext_search_index.sql"
      provides: "Raw SQL migration for FULLTEXT index"
      contains: "CREATE FULLTEXT INDEX"
    - path: "apps/api/readme.md"
      provides: "Migration documentation"
      contains: "FULLTEXT"
  key_links:
    - from: "FlexQueryBuilder.ts line 223"
      to: "flex_records.search_text FULLTEXT index"
      via: "MATCH AGAINST query"
      pattern: "MATCH.*AGAINST.*BOOLEAN MODE"
---

<objective>
Create FULLTEXT index on flex_records.search_text for performant full-text search

Purpose: Close gap from Phase 02 verification - the MATCH AGAINST query syntax is implemented but the FULLTEXT index required for performance doesn't exist. Without this index, full-text search does a full table scan.
Output: Raw SQL migration file and updated documentation
</objective>

<execution_context>
@~/.claude/get-shit-done/workflows/execute-plan.md
@~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@apps/api/src/plugins/workscript/schema/flexdb.schema.ts (lines 491-494 document the need)
@apps/api/drizzle.config.ts (migration output directory)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create FULLTEXT index migration</name>
  <files>apps/api/drizzle/0008_fulltext_search_index.sql</files>
  <action>
Create a raw SQL migration file that adds the FULLTEXT index to flex_records.search_text.

The migration should:
1. Use the naming convention from existing migrations (0008_fulltext_search_index.sql follows 0007_exotic_champions.sql)
2. Create the FULLTEXT index with name `flex_records_search_idx` (matches the comment in flexdb.schema.ts line 492)
3. Include a comment header explaining this is for full-text search support
4. Use IF NOT EXISTS to make it idempotent (can run multiple times safely)

SQL content:
```sql
-- FlexDB Full-Text Search Index
-- This migration adds a FULLTEXT index on flex_records.search_text
-- Required for performant MATCH AGAINST queries in FlexQueryBuilder
-- Drizzle doesn't support FULLTEXT indexes natively, hence raw SQL

CREATE FULLTEXT INDEX IF NOT EXISTS flex_records_search_idx ON flex_records(search_text);
```

Note: MySQL 5.7+ supports IF NOT EXISTS for CREATE INDEX. If targeting older MySQL, remove the IF NOT EXISTS clause.
  </action>
  <verify>File exists at apps/api/drizzle/0008_fulltext_search_index.sql and contains CREATE FULLTEXT INDEX statement</verify>
  <done>Migration file created with proper FULLTEXT index SQL</done>
</task>

<task type="auto">
  <name>Task 2: Document migration in readme</name>
  <files>apps/api/readme.md</files>
  <action>
Add a "Manual Migrations" section to apps/api/readme.md documenting how to run raw SQL migrations that Drizzle doesn't support.

Insert after the "Environment Variables" section, before "Available Endpoints":

```markdown
## Manual Migrations

Some database features require raw SQL migrations that Drizzle doesn't support natively.

### FULLTEXT Index for Full-Text Search

After running `bun run db:push` or `bun run db:migrate`, execute the FULLTEXT index migration:

```bash
# Using mysql CLI
mysql -u $DB_USER -p$DB_PASSWORD $DB_NAME < drizzle/0008_fulltext_search_index.sql

# Or via Drizzle Studio / database GUI
# Execute: CREATE FULLTEXT INDEX flex_records_search_idx ON flex_records(search_text);
```

This enables performant full-text search on FlexDB records via the `{ field: { search: "query" } }` filter syntax.
```

Keep all existing content intact. Only add this new section.
  </action>
  <verify>apps/api/readme.md contains "Manual Migrations" section with FULLTEXT index documentation</verify>
  <done>Readme updated with migration instructions for FULLTEXT index</done>
</task>

</tasks>

<verification>
1. Migration file exists: `ls apps/api/drizzle/0008_fulltext_search_index.sql`
2. Migration contains correct SQL: `grep "CREATE FULLTEXT INDEX" apps/api/drizzle/0008_fulltext_search_index.sql`
3. Readme documents migration: `grep -A 5 "Manual Migrations" apps/api/readme.md`
4. Index name matches schema comment: `grep "flex_records_search_idx" apps/api/drizzle/0008_fulltext_search_index.sql`
</verification>

<success_criteria>
- FULLTEXT index migration file created in drizzle directory
- Migration follows naming convention (0008 after 0007)
- Readme documents how to run the manual migration
- Gap from VERIFICATION.md is closed (REC-03, QRY-06 now fully satisfied)
</success_criteria>

<output>
After completion, create `.planning/phases/02-flexdb-record-operations/02-03-SUMMARY.md`
</output>
