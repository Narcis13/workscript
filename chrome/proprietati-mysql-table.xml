CREATE TABLE `activities` (
  `id` bigint unsigned NOT NULL AUTO_INCREMENT,
  `agency_id` bigint unsigned NOT NULL,
  `agent_id` bigint unsigned NOT NULL,
  `contact_id` bigint unsigned DEFAULT NULL,
  `property_id` bigint unsigned DEFAULT NULL,
  `request_id` bigint unsigned DEFAULT NULL,
  `activity_type` enum('email','telefon','whatsapp','sms','intalnire','vizionare','prezentare','negociere','contract','nota') NOT NULL,
  `status` enum('programat','in_desfasurare','finalizat','anulat','amanat') NOT NULL DEFAULT 'programat',
  `priority` enum('scazut','mediu','ridicat','urgent') NOT NULL DEFAULT 'mediu',
  `subject` varchar(255) NOT NULL,
  `description` text,
  `outcome` text,
  `notes` text,
  `scheduled_at` timestamp NULL DEFAULT NULL,
  `started_at` timestamp NULL DEFAULT NULL,
  `completed_at` timestamp NULL DEFAULT NULL,
  `duration` int DEFAULT NULL,
  `is_ai_generated` tinyint(1) NOT NULL DEFAULT '0',
  `ai_template` varchar(100) DEFAULT NULL,
  `sentiment_analysis_score` decimal(3,2) DEFAULT NULL,
  `follow_up_required` tinyint(1) NOT NULL DEFAULT '0',
  `next_action` varchar(255) DEFAULT NULL,
  `next_action_date` timestamp NULL DEFAULT NULL,
  `email_subject` varchar(255) DEFAULT NULL,
  `email_delivered` tinyint(1) DEFAULT NULL,
  `email_opened` tinyint(1) DEFAULT NULL,
  `email_clicked` tinyint(1) DEFAULT NULL,
  `call_direction` enum('inbound','outbound') DEFAULT NULL,
  `call_duration` int DEFAULT NULL,
  `call_recording_url` varchar(500) DEFAULT NULL,
  `attachments` json NOT NULL DEFAULT (_utf8mb4'[]'),
  `created_at` timestamp NOT NULL DEFAULT (now()),
  `updated_at` timestamp NOT NULL DEFAULT (now()) ON UPDATE CURRENT_TIMESTAMP,
  PRIMARY KEY (`id`),
  UNIQUE KEY `id` (`id`),
  KEY `activities_agency_idx` (`agency_id`),
  KEY `activities_agent_idx` (`agent_id`),
  KEY `activities_contact_idx` (`contact_id`),
  KEY `activities_property_idx` (`property_id`),
  KEY `activities_request_idx` (`request_id`),
  KEY `activities_type_idx` (`activity_type`),
  KEY `activities_status_idx` (`status`),
  KEY `activities_scheduled_idx` (`scheduled_at`),
  KEY `activities_followup_idx` (`follow_up_required`,`next_action_date`),
  CONSTRAINT `activities_agency_id_agencies_id_fk` FOREIGN KEY (`agency_id`) REFERENCES `agencies` (`id`),
  CONSTRAINT `activities_agent_id_agents_id_fk` FOREIGN KEY (`agent_id`) REFERENCES `agents` (`id`),
  CONSTRAINT `activities_contact_id_contacts_id_fk` FOREIGN KEY (`contact_id`) REFERENCES `contacts` (`id`),
  CONSTRAINT `activities_property_id_properties_id_fk` FOREIGN KEY (`property_id`) REFERENCES `properties` (`id`),
  CONSTRAINT `activities_request_id_client_requests_id_fk` FOREIGN KEY (`request_id`) REFERENCES `client_requests` (`id`)
) ENGINE=InnoDB DEFAULT CHARSET=utf8mb4 COLLATE=utf8mb4_0900_ai_ci;
